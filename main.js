(()=>{"use strict";function e(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",t);var n=new Event("modal.closed");e.dispatchEvent(n)}function t(t){"Escape"===t.key&&e(document.querySelector(".popup_is-opened"))}function n(t){t.target.closest(".popup__content")||e(t.currentTarget.closest(".popup_is-opened"))}function o(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",t);var n=new Event("modal.shown");e.dispatchEvent(n)}function r(e,t){var n=t.name,o=t.description;n.textContent=e.name,o.textContent=e.description}function a(e,t){t.style="background-image: url(".concat(e,")")}function i(e){return{name:e.name,description:e.about,avatar:e.avatar,id:e._id}}var d={baseURL:"https://mesto.nomoreparties.co/",version:"v1",cohortId:"wff-cohort-17",headers:{authorization:"e178b060-afc3-4d24-8384-782bc5f9de45","Content-Type":"application/json"},getBaseURL:function(){return new URL("".concat(this.version,"/").concat(this.cohortId,"/"),this.baseURL)}};function l(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var c=function(e){return fetch(new URL("users/me",d.getBaseURL()),{method:"PATCH",headers:d.headers,body:JSON.stringify(e)}).then(l)},u=function(e){return fetch(new URL("users/me/avatar",d.getBaseURL()),{method:"PATCH",headers:d.headers,body:JSON.stringify(e)}).then(l)},s=function(e){return fetch(new URL("cards",d.getBaseURL()),{method:"POST",headers:d.headers,body:JSON.stringify(e)}).then(l)},p={getUserData:function(){return fetch(new URL("users/me",d.getBaseURL()),{headers:d.headers}).then(l)},getCardsData:function(){return fetch(new URL("cards",d.getBaseURL()),{headers:d.headers}).then(l)},updateUserData:c,updateAvatar:u,addCard:s,deleteCard:function(e){return fetch(new URL("cards/".concat(e),d.getBaseURL()),{method:"DELETE",headers:d.headers}).then(l)},toggleCardLike:function(e,t){return fetch(new URL("cards/likes/".concat(e),d.getBaseURL()),{method:t?"DELETE":"PUT",headers:d.headers}).then(l)}},m=function(e){var t=e.formElement,n=e.inputElement,o=e.errorMessage,r=e.validationConfig,a=t.querySelector(".".concat(n.id,"-error"));n.classList.add(r.inputErrorClass),a.textContent=o,a.classList.add(r.errorClass)},f=function(e){var t=e.formElement,n=e.inputElement,o=e.validationConfig,r=t.querySelector(".".concat(n.id,"-error"));n.classList.remove(o.inputErrorClass),r.textContent="",r.classList.remove(o.errorClass)},v=function(e){var t=e.inputElementList,n=e.buttonElement,o=e.validationConfig;h(t)?(n.classList.add(o.inactiveButtonClass),n.disabled=!0):(n.classList.remove(o.inactiveButtonClass),n.disabled=!1)},h=function(e){return e.some((function(e){return!e.validity.valid}))},_=function(e){var t=e.formElement,n=e.validationConfig,o=Array.from(t.querySelectorAll(n.inputSelector)),r=t.querySelector(n.submitButtonSelector);v({inputElementList:o,buttonElement:r,validationConfig:n}),o.forEach((function(e){e.addEventListener("input",(function(){!function(e){var t=e.formElement,n=e.inputElement,o=e.validationConfig;n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessagePatternMismatch):n.setCustomValidity(""),n.validity.valid?f({formElement:t,inputElement:n,validationConfig:o}):m({formElement:t,inputElement:n,errorMessage:n.validationMessage,validationConfig:o})}({formElement:t,inputElement:e,validationConfig:n}),v({inputElementList:o,buttonElement:r,validationConfig:n})}))}))},g={enableValidation:function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),_({formElement:t,validationConfig:e})}))},clearValidation:function(e){var t=e.formElement,n=e.validationConfig,o=Array.from(t.querySelectorAll(n.inputSelector)),r=t.querySelector(n.submitButtonSelector);o.forEach((function(e){e.setCustomValidity(""),f({formElement:t,inputElement:e,validationConfig:n})})),v({inputElementList:o,buttonElement:r,validationConfig:n})},showInputError:m,hideInputError:f,validationConfig:{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},setInputEventListeners:_};function y(e){console.error(e)}var C=function(e){return{name:e.name,description:e.about,avatar:e.avatar,id:e._id}},L=function(e){return{name:e.name,link:e.link,likes:e.likes.map((function(e){return C(e)})),id:e._id,owner:C(e.owner)}},E=C,S={handleDeleteBtnClick:function(e){var t=function(t){t.preventDefault(),e.apiMethod(e.cardId).then((function(){e.elementMethod(e.cardElement),e.closeModal(e.cardDeleteModal)})).catch(y)};e.cardDeleteModal.addEventListener("submit",t),e.cardDeleteModal.addEventListener("modal.closed",(function(){e.cardDeleteModal.removeEventListener("submit",t)}),{once:!0}),e.openModal(e.cardDeleteModal)},handleImageClick:function(e){var t=e.modalElement,n=t.querySelector(".popup__image"),o=t.querySelector(".popup__caption"),r=e.data;n.addEventListener("load",(function(){e.openModal(t)}),{once:!0}),n.src=r.link,n.alt=r.name,o.textContent=r.name},handleLikeBtnClick:function(e){var t=e.isCardAlreadyLiked(e.cardLikeButton),n=t?"remove":"add";e.apiMethod(e.cardData.id,t).then((function(t){var o=L(t);e.updateLikesCounter(e.likeCounter,o.likes.length),e.toggleCardLikeBtn(e.cardLikeButton,n),e.cardData=o})).catch(y)}},b=document.querySelector(".places__list"),k=document.querySelector("#card-template").content,M=document.querySelector(".profile__title"),A=document.querySelector(".profile__description"),q=document.querySelector(".profile__image"),P=document.querySelector(".popup_type_edit"),B=document.forms["edit-profile"],D=B.querySelector(".popup__button"),w=document.querySelector(".profile__edit-button"),U=document.querySelector(".profile__edit-avatar-button"),F=document.querySelector(".popup_type_edit-avatar"),R=document.forms["edit-avatar"],I=R.querySelector(".popup__button"),x=document.querySelector(".popup_type_new-card"),O=document.forms["new-place"],T=O.querySelector(".popup__button"),j=document.querySelector(".profile__add-button"),V=document.querySelector(".popup_type_image"),N=document.querySelector(".popup_type_delete-card"),J=document.forms["delete-card"],H={cardsContainer:b,cardTemplate:k,profileName:M,profileDescription:A,profileAvatar:q,editProfileModal:P,editProfileForm:B,editProfileButton:w,addCardModal:x,addCardForm:O,addCardButton:j,cardImageModal:V,popups:document.querySelectorAll(".popup"),cardDeleteModal:N,cardDeleteForm:J,editProfileAvatarButton:U,editProfileAvatarModal:F,editProfileAvatarForm:R,editProfileFormSubmitButton:D,editProfileAvatarFormSubmitButton:I,addCardSubmitButton:T};function z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}var $=document.querySelector(".places__list"),G=(document.querySelector("#card-template").content,document.querySelector(".profile__title")),K=document.querySelector(".profile__description"),Q=document.querySelector(".profile__image"),W=document.querySelector(".popup_type_edit"),X=(document.forms["edit-profile"],document.querySelector(".profile__edit-button"),document.querySelector(".popup_type_new-card")),Y=(document.forms["new-place"],document.querySelector(".profile__add-button"),document.querySelector(".popup_type_image"),document.querySelectorAll(".popup")),Z="",ee={template:H.cardTemplate,elementMethods:{deleteCard:function(e){e.remove()},toggleCardLikeBtn:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"toggle";e.classList[t]("card__like-button_is-active")},updateCardLikes:function(e,t){e.textContent=t},isCardAlreadyLiked:function(e){return e.classList.contains("card__like-button_is-active")}},eventListeners:S,utilityMethods:{isCardLiked:function(e,t){return e.likes.some((function(e){return e.id===t}))},isCardOwner:function(e,t){return e.owner.id===t}},apiMethods:{toggleCardLike:p.toggleCardLike,deleteCard:p.deleteCard},modalProperties:{cardImageModal:H.cardImageModal,cardDeleteModal:H.cardDeleteModal,cardDeleteForm:H.cardDeleteForm,openModal:o,closeModal:e}};function te(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"prepend",o=function(e,t){var n=e.configuration.template.querySelector(".card").cloneNode(!0),o=n.querySelector(".card__image"),r=n.querySelector(".card__title"),a=n.querySelector(".card__delete-button"),i=n.querySelector(".card__like-button"),d=n.querySelector(".card__like-counter");return o.src=e.data.link,o.alt=e.data.name,r.textContent=e.data.name,d.textContent=e.data.likes.length,e.configuration.utilityMethods.isCardOwner(e.data,t)?(a.classList.remove("card__delete-button_is-hidden"),a.addEventListener("click",(function(){return e.configuration.eventListeners.handleDeleteBtnClick({apiMethod:e.configuration.apiMethods.deleteCard,elementMethod:e.configuration.elementMethods.deleteCard,cardId:e.data.id,cardElement:n,closeModal:e.configuration.modalProperties.closeModal,openModal:e.configuration.modalProperties.openModal,cardDeleteForm:e.configuration.modalProperties.cardDeleteForm,cardDeleteModal:e.configuration.modalProperties.cardDeleteModal})}))):a.classList.add("card__delete-button_is-hidden"),e.configuration.utilityMethods.isCardLiked(e.data,t)&&i.classList.add("card__like-button_is-active"),i.addEventListener("click",(function(){return e.configuration.eventListeners.handleLikeBtnClick({cardLikeButton:i,userId:t,likeCounter:d,cardData:e.data,apiMethod:e.configuration.apiMethods.toggleCardLike,updateLikesCounter:e.configuration.elementMethods.updateCardLikes,isCardAlreadyLiked:e.configuration.elementMethods.isCardAlreadyLiked,toggleCardLikeBtn:e.configuration.elementMethods.toggleCardLikeBtn})})),o.addEventListener("click",(function(){e.configuration.eventListeners.handleImageClick({data:e.data,modalElement:e.configuration.modalProperties.cardImageModal,openModal:e.configuration.modalProperties.openModal})})),n}(e,t);$[n](o)}function ne(e,t){t.querySelector(".popup__button").textContent=e?"Сохранение...":"Сохранить"}Promise.all([p.getUserData(),p.getCardsData()]).then((function(e){var t,n,o=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,a,i,d=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(o=a.call(n)).done)&&(d.push(o.value),d.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw r}}return d}}(t,n)||function(e,t){if(e){if("string"==typeof e)return z(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?z(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=o[0],d=o[1],l=E(i);Z=l.id,a(l.avatar,Q),r(l,{name:G,description:K}),d.forEach((function(e){var t=L(e);te({configuration:ee,data:t},Z,"append")}))})).catch(y),Y.forEach((function(t){var o;t.classList.add("popup_is-animated"),(o=t).addEventListener("click",n),o.querySelector(".popup__close").addEventListener("click",(function(){return e(o)}))})),H.editProfileForm.addEventListener("submit",(function(t){var n,o,a,d,l,u,s,p,m;t.preventDefault(),ne(!0,H.editProfileForm),n={form:H.editProfileForm,profile:{name:G,description:K},apiMethod:c,onApiError:y,onApiSuccess:r,finalAction:ne},a=n.profile,d=n.apiMethod,l=n.onApiError,u=n.onApiSuccess,s=n.finalAction,p=(o=n.form).elements.name,m=o.elements.description,d({name:p.value,about:m.value}).then((function(e){var t=i(e);u(t,a)})).catch(l).finally((function(){return s(!1,o)})),e(W)})),H.addCardForm.addEventListener("submit",(function(t){var n,o,r,a,i,d,l,c,u;t.preventDefault(),ne(!0,H.addCardForm),n={form:H.addCardForm,cardObject:{configuration:ee},apiMethod:s,onApiError:y,onApiSuccess:te,finalAction:ne},r=n.cardObject,a=n.apiMethod,i=n.onApiError,d=n.onApiSuccess,l=n.finalAction,c=(o=n.form).elements["place-name"],u=o.elements.link,a({name:c.value,link:u.value}).then((function(e){var t=L(e),n=t.owner.id;d({configuration:r.configuration,data:t},n),o.reset()})).catch(i).finally((function(){return l(!1,o)})),e(X)})),H.editProfileButton.addEventListener("click",(function(){var e,t,n,r,a,i;e=H.editProfileForm,t={name:H.profileName,description:H.profileDescription},n=e.elements.name,r=e.elements.description,a=t.name,i=t.description,n.value=a.textContent,r.value=i.textContent,g.clearValidation({formElement:H.editProfileForm,validationConfig:g.validationConfig}),o(H.editProfileModal)})),H.editProfileAvatarButton.addEventListener("click",(function(){o(H.editProfileAvatarModal)})),H.editProfileAvatarForm.addEventListener("submit",(function(t){var n,o,r,d,l,c;t.preventDefault(),ne(!0,H.editProfileAvatarForm),n={form:H.editProfileAvatarForm,avatarElement:H.profileAvatar,apiMethod:u,onApiError:y,onApiSuccess:a,finalAction:ne},r=n.avatarElement,d=n.onApiError,l=n.onApiSuccess,c=n.finalAction,(0,n.apiMethod)({avatar:(o=n.form).elements["avatar-link"].value}).then((function(e){var t=i(e);l(t.avatar,r)})).catch(d).finally((function(){return c(!1,o)})),e(H.editProfileAvatarModal)})),H.addCardButton.addEventListener("click",(function(){o(H.addCardModal)})),g.enableValidation(g.validationConfig)})();